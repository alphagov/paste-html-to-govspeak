<!doctype html>
<html lang="en" class="govuk-template">
  <head>
    <meta charset="utf-8">
    <title>paste-html-to-govspeak debug</title>
    <link href="govuk-frontend-2.7.0.min.css" rel="stylesheet">
    <style>
      pre {
        min-height: 100px;
        max-height: 500px;
        overflow-y: scroll;
        border: 1px solid black;
        white-space: pre-wrap;
      }

      #html-input {
        white-space: pre;
      }
    </style>
  </head>
  <body class="govuk-template__body">
    <div class="govuk-width-container">
      <main class="govuk-main-wrapper">
        <h1 class="govuk-heading-xl">paste-html-to-govspeak debug</h1>
        <p class="govuk-body">
          A tool that converts pastes HTML into
          <a href="https://github.com/alphagov/govspeak" target="_blank">govspeak</a>.
          For more information check the
          <a href="https://github.com/alphagov/paste-html-to-govspeak#readme" target="_blank">repo</a>.
        </p>
        <h2 class="govuk-heading-l">Input</h2>
        <textarea class="govuk-textarea" rows=20></textarea>
        <hr>
        <h2 class="govuk-heading-l">Data from last paste</h2>

        <h3 class="govuk-heading-m">HTML Input</h3>
        <pre id="html-input"></pre>

        <h3 class="govuk-heading-m">Text Input</h3>
        <pre id="text-input"></pre>

        <h3 class="govuk-heading-m">Govspeak</h3>
        <pre id="govspeak"></pre>

        <script src="dist/paste-html-to-markdown.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.9.0/beautify-html.js"></script>
        <script>
          var textarea = document.querySelector('textarea')
          var htmlInputElement = document.getElementById('html-input')
          var textInputElement = document.getElementById('text-input')
          var govspeakElement = document.getElementById('govspeak')

          textarea.addEventListener('paste', function () {
            govspeakElement.textContent = ''
          })

          textarea.addEventListener('paste', window.pasteHtmlToGovspeak)

          textarea.addEventListener('htmlpaste', function (e) {
            if (e.detail) {
              htmlInputElement.textContent = prettyHtml(e.detail)
            } else {
              htmlInputElement.textContent = 'HTML was not pasted'
            }
          })

          textarea.addEventListener('textpaste', function (e) {
            if (e.detail) {
              textInputElement.textContent = e.detail
            } else {
              textInputElement.textContent = 'Text was not pasted'
            }
          })

          textarea.addEventListener('govspeak', function (e) {
            govspeakElement.textContent = e.detail
          })

          function prettyHtml (html) {
            try {
              return window.html_beautify(html, {
                indent_size: 2,
                wrap_line_length: 160,
                wrap_attributes: 'force-expand-multiline'
              })
            } catch (err) {
              console.error(err)
              return html
            }
          }
        </script>
      </main>
    </div>
  </body>
</html>
